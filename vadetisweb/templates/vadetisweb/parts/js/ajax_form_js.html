<!-- BEGIN AJAX FORM JS -->
<script type="text/javascript">
    $('#{{ formid }}').on('submit', function (event) {
        event.preventDefault();
        clear_form_errors("{{ formid }}");
        clear_messages();
        $.post({
            url: $(this).attr('action'){% if format %}+'?format={{ format }}'{% endif %},
            data: new FormData(this),
            type: $(this).attr('method'),
            enctype: $(this).attr('enctype'),
            processData: false,
            contentType: false,
            success: function(data, status, xhr) {
                if (data.location) {
                    window.location = data.location;

                } else if(data.responseJSON !== undefined && data.responseJSON.hasOwnProperty('messages')) {
                    print_messages(data.responseJSON.messages);

                } else if (data.hasOwnProperty('messages')) {
                    print_messages(data.messages);
                }
            },
            error: function(data, status, xhr) {
                console.error("Sending asynchronous failed");
                if(data.responseJSON !== undefined && data.responseJSON.hasOwnProperty('messages')) {
                    print_messages(data.responseJSON.messages);

                } else if (data.hasOwnProperty('messages')) {
                    print_messages(data.messages);
                }
                if(data.responseJSON !== undefined && data.responseJSON.hasOwnProperty('form_errors')) {
                    print_form_errors(data.responseJSON.form_errors);

                } else if (data.hasOwnProperty('form_errors')) {
                    print_form_errors(data.form_errors);
                }
            }
        });
    });
</script>
<!-- END AJAX FORM JS -->
